!function(c){var b=function(d){this.defined="undefined"!==typeof localStorage;var f="garlic:"+document.domain+">test";try{localStorage.setItem(f,f);localStorage.removeItem(f)}catch(g){this.defined=false}};b.prototype={constructor:b,get:function(d,h){var f=localStorage.getItem(d);if(f){try{f=JSON.parse(f)}catch(g){}return f}else{if("undefined"!==typeof h){return h}else{return null}}},has:function(d){return localStorage.getItem(d)?true:false},set:function(d,f,e){if(""===f||(f instanceof Array&&f.length===0)){this.destroy(d)}else{f=JSON.stringify(f);localStorage.setItem(d,f)}return"function"===typeof e?e():true},destroy:function(d,e){localStorage.removeItem(d);return"function"===typeof e?e():true},clean:function(e){for(var d=localStorage.length-1;d>=0;d--){if("undefined"===typeof Array.indexOf&&-1!==localStorage.key(d).indexOf("garlic:")){localStorage.removeItem(localStorage.key(d))}}return"function"===typeof e?e():true},clear:function(d){localStorage.clear();return"function"===typeof d?d():true}};var a=function(e,f,d){this.init("garlic",e,f,d)};a.prototype={constructor:a,init:function(f,e,g,d){this.type=f;this.$element=c(e);this.options=this.getOptions(d);this.storage=g;this.path=this.options.getPath(this.$element)||this.getPath();this.parentForm=this.$element.closest("form");this.$element.addClass("garlic-auto-save");this.expiresFlag=!this.options.expires?false:(this.$element.data("expires")?this.path:this.getPath(this.parentForm))+"_flag";this.$element.on(this.options.events.join("."+this.type+" "),false,c.proxy(this.persist,this));if(this.options.destroy){c(this.parentForm).on("submit reset",false,c.proxy(this.destroy,this))}this.retrieve()},getOptions:function(d){return c.extend({},c.fn[this.type].defaults,d,this.$element.data())},persist:function(){if(this.val===this.getVal()){return}this.val=this.getVal();if(this.options.expires){this.storage.set(this.expiresFlag,(new Date().getTime()+this.options.expires*1000).toString())}var d=this.options.prePersist(this.$element,this.val);if(typeof d=="string"){this.val=d}this.storage.set(this.path,this.val);this.options.onPersist(this.$element,this.val)},getVal:function(){return !this.$element.is("input[type=checkbox]")?this.$element.val():(this.$element.prop("checked")?"checked":"unchecked")},retrieve:function(){if(this.storage.has(this.path)){if(this.options.expires){var d=new Date().getTime();if(this.storage.get(this.expiresFlag)<d.toString()){this.storage.destroy(this.path);return}else{this.$element.attr("expires-in",Math.floor((parseInt(this.storage.get(this.expiresFlag))-d)/1000))}}var e=this.$element.val();var f=this.storage.get(this.path);var f=this.options.preRetrieve(this.$element,e,f);if(typeof f=="boolean"&&f==false){return}if(this.options.conflictManager.enabled&&this.detectConflict()){return this.conflictManager()}if(this.$element.is("input[type=radio], input[type=checkbox]")){if("checked"===f||this.$element.val()===f){return this.$element.prop("checked",true)}else{if("unchecked"===f){this.$element.prop("checked",false)}}return}this.$element.val(f);this.$element.trigger("input");this.options.onRetrieve(this.$element,f);return}},detectConflict:function(){var d=this;if(this.$element.is("input[type=checkbox], input[type=radio]")){return false}if(this.$element.val()&&this.storage.get(this.path)!==this.$element.val()){if(this.$element.is("select")){var e=false;this.$element.find("option").each(function(){if(c(this).index()!==0&&c(this).attr("selected")&&c(this).val()!==d.storage.get(this.path)){e=true;return}});return e}return true}return false},conflictManager:function(){if("function"===typeof this.options.conflictManager.onConflictDetected&&!this.options.conflictManager.onConflictDetected(this.$element,this.storage.get(this.path))){return false}if(this.options.conflictManager.garlicPriority){this.$element.data("swap-data",this.$element.val());this.$element.data("swap-state","garlic");this.$element.val(this.storage.get(this.path))}else{this.$element.data("swap-data",this.storage.get(this.path));this.$element.data("swap-state","default")}this.swapHandler();this.$element.addClass("garlic-conflict-detected");this.$element.closest("input[type=submit]").attr("disabled",true)},swapHandler:function(){var d=c(this.options.conflictManager.template);this.$element.after(d.text(this.options.conflictManager.message));d.on("click",false,c.proxy(this.swap,this))},swap:function(){var d=this.$element.data("swap-data");this.$element.data("swap-state","garlic"===this.$element.data("swap-state")?"default":"garlic");this.$element.data("swap-data",this.$element.val());c(this.$element).val(d);this.options.onSwap(this.$element,this.$element.data("swap-data"),d)},destroy:function(){this.storage.destroy(this.path)},remove:function(){this.destroy();if(this.$element.is("input[type=radio], input[type=checkbox]")){c(this.$element).attr("checked",false);return}this.$element.val("")},getPath:function(i){if("undefined"===typeof i){i=this.$element}if(this.options.getPath(i)){return this.options.getPath(i)}if(i.length!=1){return false}var j="",e=i.is("input[type=checkbox]"),h=i;while(h.length){var g=h[0],d=g.nodeName;if(!d){break}d=d.toLowerCase();var f=h.parent(),k=f.children(d);if(!c(g).is("form, input, select, textarea")&&!e){h=f;continue}d+=c(g).attr("name")?"."+c(g).attr("name"):"";if(k.length>1&&!c(g).is("input[type=radio]")){d+=":eq("+k.index(g)+")"}j=d+(j?">"+j:"");if("form"==g.nodeName.toLowerCase()){break}h=f}return"garlic:"+document.domain+(this.options.domain?"*":window.location.pathname)+">"+j},getStorage:function(){return this.storage}};c.fn.garlic=function(g,f){var d=c.extend(true,{},c.fn.garlic.defaults,g,this.data()),i=new b(),e=false;if(!i.defined){return false}function h(j){var m=c(j),l=m.data("garlic"),k=c.extend({},d,m.data());if("undefined"!==typeof k.storage&&!k.storage){return}if("password"===c(j).attr("type")){return}if(!l){m.data("garlic",(l=new a(j,i,k)))}if("string"===typeof g&&"function"===typeof l[g]){return l[g]()}}this.each(function(){if(c(this).is("form")){c(this).find(d.inputs).each(function(){if(c(this).is(d.excluded)){return}e=h(c(this))})}else{if(c(this).is(d.inputs)){if(c(this).is(d.excluded)){return}e=h(c(this))}}});return"function"===typeof f?f():e};c.fn.garlic.Constructor=a;c.fn.garlic.defaults={destroy:true,inputs:"input, textarea, select",excluded:'input[type="file"], input[type="hidden"], input[type="submit"], input[type="reset"]',events:["DOMAttrModified","textInput","input","change","click","keypress","paste","focus"],domain:false,expires:false,conflictManager:{enabled:false,garlicPriority:true,template:'<span class="garlic-swap"></span>',message:"This is your saved data. Click here to see default one",onConflictDetected:function(d,e){return true}},getPath:function(d){},preRetrieve:function(d,f,e){return e},onRetrieve:function(d,e){},prePersist:function(d,e){return false},onPersist:function(d,e){},onSwap:function(d,f,e){}};c(window).on("load",function(){c('[data-persist="garlic"]').each(function(){c(this).garlic()})})}(window.jQuery||window.Zepto);